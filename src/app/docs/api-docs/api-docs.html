<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>μ λ³΄ API μ—°λ™ κ°€μ΄λ“</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      line-height: 1.6;
      max-width: 1000px;
      margin: 0 auto;
      padding: 20px;
      color: #333;
    }

    h1 {
      color: #2563eb;
      border-bottom: 3px solid #2563eb;
      padding-bottom: 10px;
    }

    h2 {
      color: #1e40af;
      margin-top: 40px;
    }

    h3 {
      color: #3b82f6;
    }

    code {
      background: #f3f4f6;
      padding: 2px 6px;
      border-radius: 3px;
      font-family: 'Monaco', 'Courier New', monospace;
    }

    pre {
      background: #1e293b;
      color: #e2e8f0;
      padding: 20px;
      border-radius: 8px;
      overflow-x: auto;
    }

    pre code {
      background: none;
      color: inherit;
      padding: 0;
    }

    .endpoint {
      background: #dbeafe;
      padding: 15px;
      border-left: 4px solid #2563eb;
      margin: 20px 0;
      border-radius: 4px;
    }

    .note {
      background: #fef3c7;
      padding: 15px;
      border-left: 4px solid #f59e0b;
      margin: 20px 0;
      border-radius: 4px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin: 20px 0;
    }

    th,
    td {
      border: 1px solid #e5e7eb;
      padding: 12px;
      text-align: left;
    }

    th {
      background: #f3f4f6;
      font-weight: 600;
    }
  </style>
</head>

<body>
  <h1>π” μ λ³΄ API μ—°λ™ κ°€μ΄λ“</h1>

  <p>μ΄ λ¬Έμ„λ” μ™Έλ¶€ μ‚¬μ΄νΈμ—μ„ μ λ³΄ μ‹μ¤ν… APIλ¥Ό μ‚¬μ©ν•λ” λ°©λ²•μ„ μ„¤λ…ν•©λ‹λ‹¤.</p>

  <h2>π“‹ λ©μ°¨</h2>
  <ul>
    <li><a href="#overview">κ°μ”</a></li>
    <li><a href="#endpoints">API μ—”λ“ν¬μΈνΈ</a></li>
    <li><a href="#encryption">μ•”νΈν™” λ°©μ‹</a></li>
    <li><a href="#library">μ•”νΈν™” λΌμ΄λΈλ¬λ¦¬</a></li>
    <li><a href="#example">μ‚¬μ© μμ </a></li>
  </ul>

  <h2 id="overview">π“ κ°μ”</h2>
  <p>μ λ³΄ λ°μ΄ν„°μ λ³΄μ•μ„ μ„ν•΄ <strong>RSA κ³µκ°ν‚¤ μ•”νΈν™”</strong>λ¥Ό μ‚¬μ©ν•©λ‹λ‹¤.</p>
  <ul>
    <li><strong>λ¨λ“  ν•„λ“</strong> (title, content, email, name, phone) μ•”νΈν™”ν•μ—¬ μ „μ†΅</li>
    <li>λ„¤νΈμ›ν¬ νμ΄λ΅λ“μ—λ” μ•”νΈλ¬Έλ§ λ…Έμ¶λ¨</li>
    <li>μ„λ²„μ—μ„λ§ λ³µνΈν™” κ°€λ¥</li>
  </ul>

  <h2 id="endpoints">π” API μ—”λ“ν¬μΈνΈ</h2>

  <div class="endpoint">
    <h3>1. κ³µκ°ν‚¤ μ΅°ν</h3>
    <p><code>GET /api/public-key</code></p>
    <p><strong>μ‘λ‹µ:</strong></p>
    <pre><code>{
  "publicKey": "-----BEGIN PUBLIC KEY-----\n...\n-----END PUBLIC KEY-----"
}</code></pre>
  </div>

  <div class="endpoint">
    <h3>2. μ λ³΄ μ μ¶</h3>
    <p><code>POST /api/inquiries</code></p>
    <p><strong>μ”μ²­ ν—¤λ”:</strong></p>
    <pre><code>Content-Type: application/json</code></pre>
    <p><strong>μ”μ²­ λ³Έλ¬Έ:</strong></p>
    <pre><code>{
  "encrypted_title": "base64_μ•”νΈν™”λ_μ λ©",
  "encrypted_content": "base64_μ•”νΈν™”λ_λ‚΄μ©",
  "encrypted_email": "base64_μ•”νΈν™”λ_μ΄λ©”μΌ",
  "encrypted_name": "base64_μ•”νΈν™”λ_μ΄λ¦„",
  "encrypted_phone": "base64_μ•”νΈν™”λ_μ „ν™”λ²νΈ" // optional
}</code></pre>
    <p><strong>μ‘λ‹µ (μ„±κ³µ):</strong></p>
    <pre><code>{
  "id": "uuid",
  "message": "Inquiry submitted successfully..."
}</code></pre>
  </div>

  <h2 id="encryption">π” μ•”νΈν™” λ°©μ‹</h2>
  <table>
    <thead>
      <tr>
        <th>ν•­λ©</th>
        <th>μ„¤λ…</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>μ•κ³ λ¦¬μ¦</td>
        <td>RSA-OAEP (2048bit)</td>
      </tr>
      <tr>
        <td>ν•΄μ‹</td>
        <td>SHA-256</td>
      </tr>
      <tr>
        <td>μΈμ½”λ”©</td>
        <td>Base64</td>
      </tr>
      <tr>
        <td>μ•”νΈν™” λ€μƒ</td>
        <td>title, content, email, name, phone (λ¨λ“  ν•„λ“)</td>
      </tr>
    </tbody>
  </table>

  <h2 id="library">π“¦ μ•”νΈν™” λΌμ΄λΈλ¬λ¦¬</h2>
  <p>μ κ³µλλ” JavaScript λΌμ΄λΈλ¬λ¦¬λ¥Ό μ‚¬μ©ν•λ©΄ μ‰½κ² μ—°λ™ν•  μ μμµλ‹λ‹¤.</p>

  <h3>λΌμ΄λΈλ¬λ¦¬ λ΅λ“</h3>
  <pre><code>&lt;script src="https://cherish-jiran.vercel.app/api/inquiry-encrypt"&gt;&lt;/script&gt;</code></pre>

  <h3>μ£Όμ” λ©”μ„λ“</h3>
  <table>
    <thead>
      <tr>
        <th>λ©”μ„λ“</th>
        <th>μ„¤λ…</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><code>init()</code></td>
        <td>κ³µκ°ν‚¤λ¥Ό κ°€μ Έμ™€μ„ μ΄κΈ°ν™”</td>
      </tr>
      <tr>
        <td><code>encrypt(formData)</code></td>
        <td>νΌ λ°μ΄ν„°λ¥Ό μ•”νΈν™”</td>
      </tr>
      <tr>
        <td><code>submit(formData)</code></td>
        <td>μ•”νΈν™” + API μ „μ†΅</td>
      </tr>
    </tbody>
  </table>

  <h2 id="example">π’΅ μ‚¬μ© μμ </h2>

  <h3>λ°©λ²• 1: λΌμ΄λΈλ¬λ¦¬ μ‚¬μ© (κ¶μ¥)</h3>
  <pre><code>// 1. λΌμ΄λΈλ¬λ¦¬ μ΄κΈ°ν™”
const encryptor = new InquiryEncryptor('https://yoursite.com');
await encryptor.init();

// 2. μ λ³΄ μ μ¶
const result = await encryptor.submit({
  title: 'μ λ³΄ μ λ©',
  content: 'μ λ³΄ λ‚΄μ©μ…λ‹λ‹¤',
  name: 'ν™κΈΈλ™',
  phone: '010-1234-5678',
  email: 'hong@example.com'
});

console.log('μ λ³΄ μ™„λ£:', result);</code></pre>

  <h3>λ°©λ²• 2: μλ™ μ•”νΈν™”</h3>
  <pre><code>// 1. κ³µκ°ν‚¤ κ°€μ Έμ¤κΈ°
const keyRes = await fetch('https://cherish-jiran.vercel.app/api/public-key');
const { publicKey } = await keyRes.json();

// 2. μ•”νΈν™” ν•¨μ (Web Crypto API)
async function encryptRSA(publicKeyPem, text) {
  // PEMμ„ CryptoKeyλ΅ λ³€ν™
  const pemContents = publicKeyPem
    .replace('-----BEGIN PUBLIC KEY-----', '')
    .replace('-----END PUBLIC KEY-----', '')
    .replace(/\s/g, '');

  const binaryDer = Uint8Array.from(atob(pemContents), c => c.charCodeAt(0));

  const cryptoKey = await crypto.subtle.importKey(
    'spki',
    binaryDer.buffer,
    { name: 'RSA-OAEP', hash: 'SHA-256' },
    true,
    ['encrypt']
  );

  // μ•”νΈν™”
  const encoded = new TextEncoder().encode(text);
  const encrypted = await crypto.subtle.encrypt(
    { name: 'RSA-OAEP' },
    cryptoKey,
    encoded
  );

  // Base64 μΈμ½”λ”©
  return btoa(String.fromCharCode(...new Uint8Array(encrypted)));
}

// 3. λ°μ΄ν„° μ•”νΈν™”
const encryptedTitle = await encryptRSA(publicKey, 'μ λ³΄ μ λ©');
const encryptedContent = await encryptRSA(publicKey, 'μ λ³΄ λ‚΄μ©');
const encryptedEmail = await encryptRSA(publicKey, 'hong@example.com');
const encryptedName = await encryptRSA(publicKey, 'ν™κΈΈλ™');
const encryptedPhone = await encryptRSA(publicKey, '010-1234-5678');

// 4. API μ „μ†΅
const response = await fetch('https://cherish-jiran.vercel.app/api/inquiries', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    encrypted_title: encryptedTitle,
    encrypted_content: encryptedContent,
    encrypted_email: encryptedEmail,
    encrypted_name: encryptedName,
    encrypted_phone: encryptedPhone
  })
});

const result = await response.json();
console.log('μ λ³΄ μ™„λ£:', result);</code></pre>

  <div class="note">
    <strong>β οΈ μ£Όμμ‚¬ν•­</strong>
    <ul>
      <li>κ³µκ°ν‚¤λ” λ§¤λ² μƒλ΅ κ°€μ Έμ¤μ§€ λ§κ³  μΊμ‹ν•μ—¬ μ‚¬μ©ν•μ„Έμ”</li>
      <li>HTTPSλ¥Ό μ‚¬μ©ν•μ—¬ μ „μ†΅ μ¤‘ λ³΄μ•μ„ μ μ§€ν•μ„Έμ”</li>
      <li>μ•”νΈν™” μ‹¤ν¨ μ‹ μ μ ν• μ—λ¬ μ²λ¦¬λ¥Ό κµ¬ν„ν•μ„Έμ”</li>
    </ul>
  </div>

  <h2>π”— κ΄€λ ¨ λ¦¬μ†μ¤</h2>
  <ul>
    <li>π€ <a href="/integration-guide.html">μ™Έλ¶€ μ‚¬μ΄νΈ μ—°λ™ κ°€μ΄λ“</a> - 3κ°€μ§€ μ—°λ™ λ°©λ²•</li>
    <li>π“¥ <a href="/sample-form.html" download>μƒν” HTML λ‹¤μ΄λ΅λ“</a> - μ¦‰μ‹ μ‚¬μ© κ°€λ¥</li>
    <li>π“¦ <a href="/inquiry-encrypt.js" download>μ•”νΈν™” λΌμ΄λΈλ¬λ¦¬</a> - JavaScript νμΌ</li>
    <li>π”‘ <a href="/api/public-key">κ³µκ°ν‚¤ API ν…μ¤νΈ</a></li>
  </ul>

  <hr style="margin: 40px 0;">
  <p style="text-align: center; color: #6b7280;">
    Β© 2025 μ§€λ€μ§€κµν¨λ°€λ¦¬ μ¤λ¦¬κ²½μ μ λ³΄κ΄€λ¦¬μ„Όν„°
  </p>
</body>

</html>